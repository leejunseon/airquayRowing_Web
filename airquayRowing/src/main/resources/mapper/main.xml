<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="mapper.main">
	<select id="raceStartPoling" parameterType="String" resultType="int">
		select raceinfo.check_onoff 
		
		from airquay.raceinfo
		
		where raceinfo.race_num = '${value}';
	</select>
	
	<select id="getPassTimer"  resultType="com.airquay.rowing.vo.main">
		select pastHour, pastMinute, pastSecond, pastMiliSecond 
		
		from isOn;
	</select>
	
	<select id="getRaceInfo" parameterType="String" resultType="com.airquay.rowing.vo.main">
		select 
		raceinfo.race_num, 
		raceinfo.day_race_num, 
		raceinfo.event_name, 
		raceinfo.race_date,
		raceinfo.round_type, 
		raceinfo.start_time, 
		raceinfo.stop_time, 
		raceinfo.check_onoff,
		raceinfo.progression 
		
		from airquay.raceinfo
		
		where raceinfo.race_date = '${value}';
	</select>
	
	<select id="getBowInfo" parameterType="com.airquay.rowing.vo.main" resultType="com.airquay.rowing.vo.main">
		select 
		rec.record_num, 
		rec.race_num, 
		rec.team_num, 
		rec.rank, 
		rec.bow_num, 
		rec.500_time as fivehundred_time, 
		rec.1000_time as thousand_time, 
		rec.1500_time as thousandfivehundred_time, 
		rec.finish_time,
		ti.team_name, 
		ti.team_country
		
		from airquay.record rec 
		left join airquay.team_info ti on ti.team_num = rec.team_num
		
		where rec.race_num = '{race_num}'
		order by ${orderType};
	</select>
	
	<select id="getRankList"  parameterType="com.airquay.rowing.vo.main" resultType="com.airquay.rowing.vo.main">
		select 
		t.race_num, 
		t.bowNum, 
		bi.countryName, 
		raceinfo.raceDate, 
		concat(t.arriveHour,':', t.arriveMinute,':', t.arriveSecond,':', t.arriveMiliSecond) as arriveTime 
		
		from rowing.${tableType} t
		left join rowing.raceinfo raceinfo on raceinfo.race_num = t.race_num
		left join rowing.boatinfo bi on t.bowNum = bi.bowNum
		
		where t.race_num = ${race_num} 
		and raceinfo.raceDate = t.raceDate
		and t.raceDate = bi.raceDate
		and t.race_num = bi.race_num 
		and raceinfo.raceDate = '${raceDate}' 
		
		order by arriveTime;
	</select>
	
	<select id="checkUser" parameterType="com.airquay.rowing.vo.main" resultType="com.airquay.rowing.vo.main">
		select * 
		
		from airquay.airquay_user airquay_user 
		
		where airquay_user.user_id = '${user_id}' 
		and airquay_user.user_pw = '${user_pw}'
	</select>
	
	<select id="getUserInfo" parameterType="com.airquay.rowing.vo.main" resultType="com.airquay.rowing.vo.main">
		select
		airquay_user.user_no, 
		airquay_user.user_id, 
		airquay_user.user_name, 
		airquay_user.sex, 
		airquay_user.birth, 
		team_info.team_name, 
		team_info.team_country, 
		team_info.team_num
		
		from airquay.airquay_user airquay_user 
		left join airquay.team_info team_info on team_info.team_num = airquay_user.team_num
		
		where airquay_user.user_id = '${user_id}' and airquay_user.user_pw = '${user_pw}'
	</select>	
	
	<update id="setRaceStart" parameterType="com.airquay.rowing.vo.main">
		update raceinfo set 
		check_onoff='${check_onoff}';
	</update>
	
	<update id="pastTimeSave" parameterType="com.airquay.rowing.vo.main">
		update isOn set 
		pastHour='${pastHour}', 
		pastMinute='${pastMinute}', 
		pastSecond='${pastSecond}', 
		pastMiliSecond='${pastMiliSecond}';	
	</update>
	
	<update id="startTimeSend" parameterType="com.airquay.rowing.vo.main">
		update raceinfo set
		
		start_time='${start_time}'
		
		where raceinfo.race_num='${race_num}';
	</update>
	
	<update id="stopTimeSend" parameterType="com.airquay.rowing.vo.main">
		update raceinfo set
		
		stop_time='${stop_time}'
		
		where raceinfo.race_num='${race_num}';
	</update>
	
	<select id="getRaceList" parameterType="com.airquay.rowing.vo.main" resultType="Object">
		select * 
		
		from airquay.raceinfo ri 
		
		where ri.race_date = '2018-08-03'
	</select>
	
</mapper>